module Meow.Util where

import Splice.Api.Token.HoldingV1 qualified as Holding
import Meow.Holding

assertExpectedAdmin : (CanAssert m) => Party -> Party -> m ()
assertExpectedAdmin admin expectedAdmin = assertMsg "Expected admin does not match" (admin == expectedAdmin)

calculateSenderChange : [ContractId Holding.Holding] -> Decimal -> Update Decimal
calculateSenderChange holdingCids amountToSend = do
  senderInputAmounts <- mapA (\holdingCid -> do
    holdingView <- view <$> fetch holdingCid
    pure holdingView.amount) holdingCids
  let senderInputAmountSum : Decimal = sum senderInputAmounts
  pure (senderInputAmountSum - amountToSend)

meowTokenToHoldingCid : HasToInterface MeowToken Holding.Holding => ContractId MeowToken -> ContractId Holding.Holding
meowTokenToHoldingCid meowTokenCid = toInterfaceContractId @Holding.Holding meowTokenCid
