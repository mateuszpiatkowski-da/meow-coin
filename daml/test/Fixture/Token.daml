module Fixture.Token where

import Coin.Holding
import Daml.Script
import Fixture.Parties qualified as F.Parties

-- Reusable test fixture for token creation
data TokenFixture = TokenFixture with
    admin : Party
    sender : Party
    receiver : Party
    tokenCid : ContractId CoinToken
      deriving (Eq, Show)

-- Helper function to create a token with customizable metadata
createTestToken : Party -> Party -> Decimal -> Script (ContractId CoinToken)
createTestToken admin owner amount = do
  now <- getTime
  submit admin do
    createCmd CoinToken with
      admin
      owner
      amount
      createdAt = now

-- Standard test setup with default values
setupTestToken : Decimal -> Script TokenFixture
setupTestToken amount = do
  F.Parties.Parties{admin, sender, receiver} <- F.Parties.createParties

  tokenCid <- createTestToken admin sender amount

  pure TokenFixture with admin; sender; receiver; tokenCid
